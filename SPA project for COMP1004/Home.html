<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="Content-Type"
          content="text/html; charset=utf-8">
        
    <!--Stylesheet link-->
    <link rel="stylesheet" href="resources/styles.css" />

    <!--Script file-->
    <script src="resources/website_scripts.js"></script>
    
    <!--Bootstrap link-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <title>COMP1004 SPA</title>

    <link rel="icon" type="image/x-icon" href="resources/images/180107.jpg" />

</head>

<body>

    <!--Home div tag-->
    <div class="content" id="home">

        <h1>Home Page</h1>

        <br>

        <!--Buttons to switch between screens-->
        <button class="current_button" onclick="home()">Home</button>

        <button class="button" onclick="class180()">Add Locomotives</button>

        <button class="button" onclick="fileScreen()">Image Upload</button>

        <button class="button" onclick="listScreen()">Loco List</button>

        <br>

        <p></p>

        <br>

        <!--Content is always below the navigation buttons-->
        <img src="resources/images/91101.jpg" alt="180107 at King's Cross" />

        <p>91101 and 387173 at King's Cross</p>

        <br>

        <p>Welcome to the website. This is an application designed to allow for the storage of model locomotive names, numbers, and DCC adresses</p>

        <br>

    </div>

    <!--Generic div--> <!--        <---- That is now the only original part of the file XD    -->

    <div class="content" id="class180" style="display: none;">

        <h1>Add and remove locomotives</h1>

        <br>

        <!--Buttons to switch between screens-->

        <button class="button" onclick="home()">Home</button>

        <button class="current_button" onclick="class180()">Add locomotives</button>

        <button class="button" onclick="fileScreen()">Image Upload</button>

        <button class="button" onclick="listScreen()">Loco List</button>

        <br>

        <p></p>

        <br>

        <img src="resources/images/180107.jpg" alt="180107 at King's Cross" />

        <p>180107 at King's Cross</p>

        <form id="myForm">

            <label for="addressInput">Locomotive address:</label><br>
            <input type="number" id="addressInput" name="address" /><br />

            <label for="nameInput">Locomotive name:</label><br>
            <input type="text" id="nameInput" name="name" /><br />

            <label for="numberInput">Locomotive number:</label><br>
            <input type="number" id="numberInput" name="number" /><br />

            <button type="submit">Submit</button>
        </form>

        <script>

            const form = document.getElementById('myForm');

            form.addEventListener('submit', function (event) {
                event.preventDefault();

                let isEmpty = false;

                const locoAddress = document.getElementById('addressInput').value;
                const addressParsed = parseInt(locoAddress);

                //this is a var as it may need to be altered before the JSON is pushed
                var locoName = document.getElementById('nameInput').value;

                //checks if the field is empty
                if (locoName == '') {

                    locoName = 'N/A';

                }

                const number = document.getElementById('numberInput').value;
                const numberParsed = parseInt(number);

                if (!isNaN(addressParsed) && !isNaN(numberParsed)) {

                    var formJSON = {

                        address: addressParsed,
                        name: locoName,
                        number: numberParsed

                    };

                    console.log(formJSON);

                    var string = JSON.stringify(formJSON);

                    push(formJSON);

                    createTable();

                }

                /*

                //now redundant due to validation

                if (isEmpty) {

                    alert('Please fill out all fields');

                }
                */

                form.reset();
                
            });

        </script>

    </div>

    <!--Screen for uploading images-->
    <div class="content" id="uploadScreen" style="display: none;">

        <h1>Upload your file</h1>

        <br>

        <!--Buttons to switch between screens-->
        <button class="button" onclick="home()">Home</button>

        <button class="button" onclick="class180()">Add Locomotives</button>

        <button class="current_button" onclick="fileScreen()">Image Upload</button>

        <button class="button" onclick="listScreen()">Loco List</button>

        <br>

        <p></p>

        <form id="fileUploadForm" action="/upload" enctype="multipart/form-data" method="post">
            <input type="file" name="imageFile" id="imageFile" accept="image/*" required multiple /><br />
            <br />
            <button type="submit">Upload Image</button>
        </form>

    </div>

    <!--Screen to display the contents of locos.json/creating table entries-->
    <div class="content" id="ListScreen" style="display: none;">

        <h1>Add a new locomotive</h1>

        <br>

        <!--Buttons to switch between screens-->
        <button class="button" onclick="home()">Home</button>

        <button class="button" onclick="class180()">Add Locomotives</button>

        <button class="button" onclick="fileScreen()">Image Upload</button>

        <button class="current_button" onclick="listScreen()">Loco List</button>

        <br>

        <p></p>

        <p>Enter the file path of your JSON file here</p>

        <p style="color: red">WARNING</p>

        <p style="color: red">This will overwrite your edited list, please make sure to save a copy before proceeding</p>

        <!---
        <div id="message-box" style="display:none">

            <p>Please enter a valid path</p>

        </div>
        --->


        <!---
        <form id="JSONPath">

            <label for="nameInput">JSON file path:</label><br>
            <input type="text" id="pathInput" name="name" /><br />

            <button type="submit">Submit</button>
        </form><br />
            -->

        <script>

            //this is the old code which allowed the user to define the path to the file

            /*
            const form2 = document.getElementById('JSONPath');

            form2.addEventListener('submit', function (event) {
                event.preventDefault();

                var path = document.getElementById('pathInput').value;

                //checks if the field is empty

                if (path == '') {

                    const element = document.getElementById('message-box');

                    element.style.display = "block";

                } else if (path != '') {

                    const cleartable = document.getElementById('table-container');
                    cleartable.innerHTML = "";

                    localStorage.removeItem('locomotives');

                    readJSON(path);

                    createTable();

                    const element = document.getElementById('message-box');

                    element.style.display = "none";

                }

            });
            */

        </script>


        <input type="file" id="fileInput">
        <script>

            //this is the new code which makes use of the filereader API

            document.getElementById('fileInput').addEventListener('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    readJSON(file);
                    
                }
            });
        </script>

        <script>

            //refreshes localstorage every time the SPA is loaded. Localstorage is only used to manipulate the JSON here

            localStorage.removeItem('locomotives');

            document.addEventListener("DOMContentLoaded", () => {
                createTable();
            });
            
        </script>

        <div id="table-container"></div>

    </div>

</body>

</html>